version: "3.1"
responses:
  utter_flow_continue_interrupted: 
    - text: Let's continue with the topic {rasa_previous_flow}.
      metadata: 
        rephrase: True

  utter_ask_confirm_correction:
    - text: "Do you want to update your information?"
      buttons:
        - payload: /affirm
          title: Yes
        - payload: /deny
          title: No, please keep the previous information
      metadata: 
        rephrase: True
  
  utter_corrected_previous_input:
    - text: "Ok, I corrected the previous input."
      metadata: 
        rephrase: True
  
  utter_not_corrected_previous_input:
    - text: "Ok, I did not correct the previous input."
      metadata: 
        rephrase: True

  utter_flow_cancelled_rasa:
    - text: Okay, stopping the flow {rasa_cancelled_flow}.
      metadata:
        rephrase: True

  utter_too_complex_rasa:
    - text: This is too complex for me, let's take it one step at a time.

  utter_internal_error_rasa:
    - text: Sorry, I'm having trouble understanding you right now. Please try again later.
  
  utter_ask_confirm_human_handoff:
    - text: "Do you want to talk to a human?"
      buttons:
        - payload: /affirm
          title: "Yes, connect me to a human agent now"
        - payload: /deny
          title: "No"
  
  utter_lets_continue:
    - text: "Alright, let's continue with the topic."
      metadata: 
        rephrase: True

slots:
  confirm_correction:
    type: text
    mappings:
      - intent: affirm
        type: from_intent
        value: "True"
        conditions:
          - active_loop: question_confirm_correction
      - intent: deny
        type: from_intent
        value: "False"
        conditions:
          - active_loop: question_confirm_correction

  confirm_human_handoff:
    type: text
    mappings:
      - intent: affirm
        type: from_intent
        value: "True"
        conditions:
          - active_loop: question_confirm_human_handoff
      - intent: deny
        type: from_intent
        value: "False"
        conditions:
          - active_loop: question_confirm_human_handoff

flows:  
  pattern_continue_interrupted:
    description: A meta flow that should be started to continue an interrupted flow. 

    steps:
      - id: "0"
        action: utter_flow_continue_interrupted
  
  pattern_correction:
    description: A meta flow that should be started to correct a previous user input.

    steps:
      - id: "0"
        question: confirm_correction
        next:
          - if: confirm_correction
            then: "1"
          - else: "2"
      - id: "1"
        action: utter_corrected_previous_input
      - id: "2"
        set_slots:
          - rasa_corrected_slots: None
        next: "3"
      - id: "3"
        action: utter_not_corrected_previous_input

  pattern_cancel_flow:
    description: A meta flow that's started when a flow is cancelled.

    steps:
      - id: "0"
        action: utter_flow_cancelled_rasa

  pattern_too_complex:
    description: replies to the user that their request is too complex
    steps:
      - id: "0"
        action: utter_too_complex_rasa

  pattern_listen:
    description: user send a message that doesn't require a response
    steps:
      - id: "0"
        action: action_listen

  pattern_internal_error:
    description: internal error
    steps:
      - id: "0"
        action: utter_internal_error_rasa

  pattern_update_user_profile:
    description: updates a user profile using an action
    steps:
      - id: "0"
        action: action_update_user_profile

  pattern_human_handoff:
    description: Hands off to a human
    steps:
      - id: "0"
        question: confirm_human_handoff
        next:
          - if: confirm_human_handoff
            then: "1"
          - else: "2"
      - id: "1"
        action: action_human_handoff
      - id: "2"
        action: utter_lets_continue

        
