version: "3.1"
responses:
  utter_flow_continue_interrupted: 
    - text: Let's continue with the topic {{ flow_context.previous_flow_name }}.
      metadata: 
        rephrase: True
        template: jinja

  utter_ask_confirm_correction:
    - text: "Do you want to update the {{ flow_context.corrected_slots.keys()|join(', ') }}?"
      buttons:
        - payload: yes
          title: Yes
        - payload: no
          title: No, please keep the previous information
      metadata: 
        rephrase: True
        template: jinja
  
  utter_corrected_previous_input:
    - text: "Ok, I corrected the {{ flow_context.corrected_slots.keys()|join(', ') }}."
      metadata: 
        rephrase: True
        template: jinja
  
  utter_not_corrected_previous_input:
    - text: "Ok, I did not correct the previous input."
      metadata: 
        rephrase: True

  utter_flow_cancelled_rasa:
    - text: Okay, stopping the flow {{ flow_context.canceled_name }}.
      metadata:
        rephrase: True
        template: jinja

  utter_can_do_something_else:
    - text: "Is there anything else I can help you with?"
      metadata: 
        rephrase: True

  utter_too_complex_rasa:
    - text: This is too complex for me, let's take it one step at a time.

  utter_internal_error_rasa:
    - text: Sorry, I'm having trouble understanding you right now. Please try again later.

slots:
  confirm_correction:
    type: bool
    mappings:
      - type: custom

flows:  
  pattern_continue_interrupted:
    description: A meta flow that should be started to continue an interrupted flow. 

    steps:
      - id: "0"
        action: utter_flow_continue_interrupted
  
  pattern_correction:
    description: Confirm a previous correction of a slot value.

    steps:
      - id: "0"
        question: confirm_correction
        next:
          - if: confirm_correction
            then: "correct_slots"
          - else: "abort_correction"
      - id: "correct_slots"
        action: action_correct_flow_slot
        next: "inform_user"
      - id: "inform_user"
        action: utter_corrected_previous_input
      - id: "abort_correction"
        action: utter_not_corrected_previous_input

  pattern_cancel_flow:
    description: A meta flow that's started when a flow is cancelled.

    steps:
      - id: "cancel_flow"
        action: action_cancel_flow
        next: "inform_user"
      - id: "inform_user"
        action: utter_flow_cancelled_rasa

  pattern_too_complex:
    description: replies to the user that their request is too complex
    steps:
      - id: "0"
        action: utter_too_complex_rasa

  pattern_listen:
    description: user send a message that doesn't require a response
    steps:
      - id: "0"
        action: action_listen

  pattern_internal_error:
    description: internal error
    steps:
      - id: "0"
        action: utter_internal_error_rasa
  
  pattern_completed:
    description: a flow has been completed and there is nothing else to be done
    steps:
      - id: "0"
        action: utter_can_do_something_else

  pattern_chitchat:
    description: handle interactions with the user that are not task-oriented
    steps:
      - id: "0"
        generation_prompt: |
          You are an incredibly friendly assistant. Generate a short 
          response to the user's comment in simple english.

          User: {{latest_user_message}}
          Response:
